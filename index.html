<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Bot Verification</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.9/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root" class="min-h-screen bg-gray-100 flex items-center justify-center"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const VerificationApp = () => {
            const [step, setStep] = useState(1);
            const [timeLeft, setTimeLeft] = useState(5);
            const [isTimerComplete, setIsTimerComplete] = useState(false);

            useEffect(() => {
                if (timeLeft > 0) {
                    const timer = setInterval(() => {
                        setTimeLeft((prev) => {
                            if (prev <= 1) {
                                clearInterval(timer);
                                setIsTimerComplete(true);
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [timeLeft, step]);

            const handleContinue = () => {
                if (step < 4) {
                    setStep(step + 1);
                    setTimeLeft(5);
                    setIsTimerComplete(false);
                }
            };

            const handleGateLink = () => {
                const code = crypto.randomUUID();
                const username = new URLSearchParams(window.location.search).get('username') || 'unknown';
                // Open Telegram to send verification code to bot
                const telegramUrl = `https://t.me/DecodeToday_bot?start=verify_${code}_${username}`;
                window.open(telegramUrl, '_blank');
                // Redirect to private group after a short delay
                setTimeout(() => {
                    window.location.href = 'https://t.me/+SarEpTSciJM3NzI1';
                }, 1000); // 1-second delay to ensure Telegram opens first
            };

            return (
                <div className="p-6 bg-white rounded-lg shadow-lg max-w-md w-full text-center flex flex-col items-center">
                    <h1 className="text-2xl font-bold mb-4">Movie Bot Verification</h1>
                    <p className="text-gray-600 mb-4">Step {step} of 4</p>
                    <div className="mb-6">
                        <p className="text-lg">Please wait for {timeLeft} seconds...</p>
                    </div>
                    <div className="mt-4">
                        {isTimerComplete && step < 4 && (
                            <button
                                onClick={handleContinue}
                                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition"
                            >
                                Continue
                            </button>
                        )}
                        {isTimerComplete && step === 4 && (
                            <button
                                onClick={handleGateLink}
                                className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition"
                            >
                                Gate Link
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<VerificationApp />, document.getElementById('root'));
    </script>
</body>
</html>
